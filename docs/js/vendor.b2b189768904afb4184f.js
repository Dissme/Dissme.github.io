"use strict";(self.webpackChunkeasy_view_boilerplate=self.webpackChunkeasy_view_boilerplate||[]).push([[736],{515:function(t,e,s){s.d(e,{D$:function(){return z},Fg:function(){return G},LI:function(){return J},ku:function(){return L}});var n=Object.defineProperty,i=(t,e,s)=>(((t,e,s)=>{e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s),r=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},o=(t,e,s)=>(r(t,e,"read from private field"),s?s.call(t):e.get(t)),l=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},h=(t,e,s,n)=>(r(t,e,"write to private field"),n?n.call(t,s):e.set(t,s),s),a=(t,e,s)=>(r(t,e,"access private method"),s);const c=1,d=2,u=3,p=4,f=5,v=6,g=7,y=1,m=2,b=3,w=4,k=5;var E,P,$,M,x,_,H,O,j,T,W,C,R;class S{constructor(){l(this,E),l(this,$),i(this,"target",new EventTarget),i(this,"pool",{}),i(this,"oncePool",{}),i(this,"listeners",[])}on(t,e){"function"==typeof e&&(this.pool[t]||(this.pool[t]=new Set)).add(e)}off(t,e){var s,n,i,r,o,l;void 0===e?null==(n=null==(s=this.pool[t])?void 0:s.clear)||n.call(s):(null==(r=null==(i=this.pool[t])?void 0:i.delete)||r.call(i,e),null==(l=null==(o=this.oncePool[t])?void 0:o.delete)||l.call(o,e))}once(t,e){"function"==typeof e&&(this.oncePool[t]||(this.oncePool[t]=new Set)).add(e)}dispatch(t,e=null){var s,n,i,r;const o=new CustomEvent(t,{detail:e,cancelable:!0,bubbles:!0}),l=self.onerror;let h;const c=new WeakMap,d=[];return self.onerror=(t,e,s,n,i)=>{d.push(i),c.set(h,i)},this.listeners=[...null!=(s=this.oncePool["*"])?s:[],...null!=(n=this.oncePool[t])?n:[],...null!=(i=this.pool["*"])?i:[],...null!=(r=this.pool[t])?r:[]].map((t=>e=>{h=t;const s=t(e);d.push(s),c.set(h,s)})),this.oncePool["*"]=new Set,this.oncePool[t]=new Set,a(this,E,P).call(this,t),this.target.dispatchEvent(o),o.result=t=>c.get(t),o.results=d,self.onerror=l,a(this,$,M).call(this,t),o}}E=new WeakSet,P=function(t){this.listeners.forEach((e=>{this.target.addEventListener(t,e)}))},$=new WeakSet,M=function(t){this.listeners.forEach((e=>{this.target.removeEventListener(t,e)})),this.listeners=[]};class N{constructor(t){i(this,"port"),this.port=t}static getInstance(t){if(this.map.has(t))return this.map.get(t);const e=new this(t);return this.map.set(t,e),e}}i(N,"map",new WeakMap);class B extends N{constructor(t){super(t),i(this,"lastTime",performance.now()),i(this,"count",0),this.postMessage({type:c})}get version(){return`${this.lastTime}-${this.count}`}postMessage(t){t.prev=this.version,t.current=this.updateVersion(),this.port.postMessage(t)}updateVersion(){const t=performance.now();return t!==this.lastTime?(this.lastTime=t,this.count=0):this.count++,this.version}}i(B,"map",new WeakMap);class I extends N{constructor(t){var e;super(t),i(this,"version",""),i(this,"buffer",{}),i(this,"hook",new S),i(this,"onMessage",(({data:t})=>{const{type:e,current:s,prev:n}=t;if(e===c){if(this.version)return;this.version=s,this.hook.dispatch(e)}else this.buffer[n]=t;this.readBuffer()})),t.addEventListener("message",this.onMessage),null==(e=t.start)||e.call(t)}readBuffer(){if(!this.version)return;const t=Object.keys(this.buffer).sort(((t,e)=>{const[s,n]=t.split("-"),[i,r]=e.split("-");return s-i||n-r})),[e,s]=this.version.split("-");for(;t.length;){const n=t.pop(),[i,r]=n.split("-");if(+i<+e||i===e&&+r<+s){Reflect.deleteProperty(this.buffer,n);continue}if(this.version!==n)return;const{type:o,current:l,...h}=this.buffer[n];this.version=l,Reflect.deleteProperty(this.buffer,n),this.hook.dispatch(o,h)}}register(t,e){t===c?this.version?this.hook.once(t,e):e():this.hook.on(t,e)}unregister(t,e){this.hook.off(t,e)}}i(I,"map",new WeakMap);class A{constructor(){l(this,x,void 0),l(this,_,void 0),l(this,H,{}),i(this,"destroyed",!0)}connect(t){this.destroyed||this.destroy(),h(this,_,I.getInstance(t)),h(this,x,B.getInstance(t)),this.destroyed=!1}register(t,e){o(this,H)[t]=t=>e(null==t?void 0:t.detail),o(this,_).register(t,o(this,H)[t])}postMessage(t,e){const s=o(this,x).version;return o(this,x).postMessage({type:t,body:e}),s}destroy(){this.destroyed||(this.postMessage(g),Object.keys(o(this,H),(t=>{o(this,_).unregister(t,o(this,H)[t])})),h(this,H,{}),h(this,x,null),h(this,_,null))}}x=new WeakMap,_=new WeakMap,H=new WeakMap;class L extends A{constructor(){super(...arguments),l(this,O,{}),l(this,j,new S),i(this,"timeout",3e3),l(this,T,(async({body:{methodName:t,params:e},prev:s})=>{var n,i;const r=await(null==(i=null==(n=o(this,O)[t])?void 0:n.call)?void 0:i.call(n,null,e));super.postMessage(p,{result:r,prev:s})})),l(this,W,(({body:{result:t,prev:e}})=>{o(this,j).dispatch(e,t)})),l(this,C,(({body:{methodName:t,params:e}})=>{var s,n;null==(n=null==(s=o(this,O)[t])?void 0:s.call)||n.call(s,null,e)}))}connect(t){super.connect(t),super.register(u,o(this,T)),super.register(p,o(this,W)),super.register(v,o(this,C))}register(t,e){o(this,O)[t]=e}unregister(t){Reflect.deleteProperty(o(this,O),t)}postMessage(t,e){super.postMessage(v,{methodName:t,params:e})}sendMessage(t,e){const s=super.postMessage(u,{methodName:t,params:e});return new Promise(((t,e)=>{o(this,j).once(s,(({detail:e})=>t(e))),setTimeout((()=>{o(this,j).off(s),e("timeout")}),this.timeout)}))}}O=new WeakMap,j=new WeakMap,T=new WeakMap,W=new WeakMap,C=new WeakMap;class D{constructor(){l(this,R,[])}connect(t){const e=new A;return e.connect(t),o(this,R).push(e)-1}disconnect(t){var e,s;null==(s=null==(e=o(this,R)[t])?void 0:e.destroy)||s.call(e),o(this,R)[t]=null}postMessage(t,e,...s){let n=o(this,R);s.length&&(n=n.filter(((t,e)=>t&&s.includes(e)))),n.forEach((s=>{s.postMessage(t,e)}))}register(t,e,s){var n;null==(n=o(this,R)[s])||n.register(t,e)}destroy(){o(this,R).forEach((t=>{var e;return null==(e=null==t?void 0:t.destroy)?void 0:e.call(t)})),h(this,R,[])}}R=new WeakMap;const V={};function z(t){Object.assign(V,t)}class F{constructor(t,e){i(this,"ele"),i(this,"callOut"),i(this,"pool",{}),i(this,"handler",(t=>{var e;let{type:s,detail:n,target:i}=t;if(!this.pool[s])return;let r=null;Object.keys(this.pool[s]).forEach((t=>{var e;!function(t,e){return t===e||new RegExp(`^${t}`).test(e)}(t,null==(e=null==i?void 0:i.getAttribute)?void 0:e.call(i,"_eid"))||(!r||r.length<t.length)&&(r=t)})),r&&(null!=(e=V[s])&&e.format&&(n=V[s].format(t)),null==n&&(n={}),"object"!=typeof n&&(n={value:n}),n._eid=r,this.callOut({type:s,detail:n}))})),this.ele=t,this.callOut=e}defaultUnbind(){}getEventNames(t){const e={};return Object.keys(this.pool).forEach((s=>{this.pool[s][t]&&(e[s]=!0)})),e}on(t,e,s){var n,i,r;if(this.pool[t]||(this.pool[t]={},this.ele.addEventListener(t,this.handler)),this.pool[t][e])return this.pool[t][e];let o=null!=(r=null==(i=null==(n=V[t])?void 0:n.call)?void 0:i.call(n,this.ele,s,this.dispatch.bind(null,t,s)))?r:this.defaultUnbind;return this.pool[t][e]=o,o}move(t,e){Object.keys(this.pool).forEach((s=>{const n=this.pool[s][t];!n||(this.pool[s][e]=n,Reflect.deleteProperty(this.pool[s],t))}))}off(t,e){if("*"===t)return Object.keys(this.pool).filter((t=>{if(this.pool[t][e])return this.off(t,e),!0}));!this.pool[t]||(this.pool[t][e]&&(this.pool[t][e](),Reflect.deleteProperty(this.pool[t],e)),Object.keys(this.pool[t]).length||(this.ele.removeEventListener(t,this.handler),Reflect.deleteProperty(this.pool,t)))}dispatch(t,e,s){e.dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:s}))}destroy(){Object.keys(this.pool).forEach((t=>{Object.keys(this.pool[t]).forEach((t=>t())),this.ele.removeEventListener(t,this.handler)})),this.pool=null,this.ele=null}}function U(t,e){const s=document.createComment(`${e} _eid="${t}" /`);return s._fragment=!0,s.children=[],s.id=t,s.tag=e,Object.assign(s,X),s}const X={setAttribute(t,e){"_eid"===t&&(this.id=e),this.startTag?(this.startTag.textContent=`${this.tag} _eid="${this.id}"`,this.textContent=`/${this.tag}`):this.textContent=`${this.tag} _eid="${this.id}" /`},append(...t){this.startTag||(this.startTag=document.createComment(`${this.tag} _eid="${this.id}"`),this.textContent=`/${this.tag}`,this.parentNode.insertBefore(this.startTag,this));const e=document.createDocumentFragment();t.forEach((t=>{e.append(t),this.children.push(t)})),this.parentNode.insertBefore(e,this)},remove(){var t;this.children.forEach((t=>t.remove())),this.children=[],null==(t=this.startTag)||t.remove(),this.constructor.prototype.remove.call(this)},insertBefore(t,e){var s,n;let i=this.children.findIndex((e=>{var s;return e===(null!=(s=t.$ele)?s:t)}));i>=0&&this.children.splice(i,1);let r=this.children.findIndex((t=>t===e));-1===r&&(r=this.children.length),this.children.splice(r,0,null!=(s=t.$ele)?s:t),this.parentNode.insertBefore(t,null!=(n=e.startTag)?n:e)}};function Y(t){!t||Object.keys(t).forEach((e=>{"className"===e&&(t.class=t[e],t[e]=!1),t[e]||Reflect.deleteProperty(t,e)}))}function Z(t,e){return document.createElementNS({svg:"http://www.w3.org/2000/svg",browser:"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul",math:"http://www.w3.org/1998/Math/MathML"}[t]||(null==e?void 0:e.namespaceURI)||"http://www.w3.org/1999/xhtml",t)}function q(t,e,s,n){const i={},r={[y]({id:t,payload:{_text:e,text:r,_fragment:o,tag:h,props:a,eventHandlers:c}}){var d,u;let p;Y(a);const[,f]=null!=(d=t.match(/(.*)?,([^,]+)$/))?d:[];e?p=document.createTextNode(r):o?p=U(t,h):(p=Z(h,s[f]),Object.keys(a).forEach((t=>{p.setAttribute(t,a[t])}))),l(f,t,p),i[t]=p,null==(u=null==c?void 0:c.forEach)||u.call(c,(e=>{n.on(e,t,p)}))},[b]({id:t}){const e=s[t.replace(/,\d+$/,"")];if(null!=e&&e._fragment){const n=e.children.findIndex((e=>e===s[t]));n>=0&&e.children.splice(n,1)}s[t].remove();const i=new RegExp(`^${t}`);Object.keys(s).forEach((t=>{!i.test(t)||(n.off("*",t),Reflect.deleteProperty(s,t))}))},[m]({id:t,payload:{props:e,eventHandlers:i}}){Y(e);const r=s[t];if(e&&r.setAttribute){const t=r.getAttributeNames();Object.keys(e).forEach((s=>{const n=t.indexOf(s);n>=0&&(t[n]=null),r.setAttribute(s,e[s]),"value"===s&&(r.value=e[s])})),t.forEach((t=>t&&"_eid"!==t&&r.removeAttribute(t)))}if(i){const e=n.getEventNames(t);i.forEach((s=>{if(e[s])return Reflect.deleteProperty(e,s);n.on(s,t,r)})),Object.keys(e).forEach((e=>{n.off(e,t)}))}},[w]({id:t,payload:{id:e}}){var i;const r=s[t],[,o]=null!=(i=t.match(/(.*)?,([^,]+)$/))?i:[],h=new RegExp(`^${t}`);l(o,e,r),Object.keys(s).forEach((t=>{var i,r;if(!h.test(t))return;const o=t.replace(h,e);null==(r=(i=s[t]).setAttribute)||r.call(i,"_eid",o),s[o]=s[t],Reflect.deleteProperty(s,t),n.move(t,o)}))},[k]({payload:t}){t.forEach((({id:t,_text:e,text:i,_fragment:r,tag:o,props:h,eventHandlers:a})=>{var c,d;const[,u]=null!=(c=t.match(/(.*)?,([^,]+)$/))?c:[];let p;Y(h),e?p=document.createTextNode(i):r?p=U(t,o):(p=Z(o,s[u]),Object.keys(h).forEach((t=>{p.setAttribute(t,h[t])}))),l(u,t,p),s[t]=p,null==(d=null==a?void 0:a.forEach)||d.call(a,(e=>{n.on(e,t,p)}))}))}};function o(t){const e=document.createDocumentFragment();return t._fragment&&(t.startTag&&e.append(t.startTag),t.children.forEach((t=>{e.append(o(t))}))),e.append(t),e.$ele=t,e}function l(t,n,i){var r,l,h;const a=null!=(r=s[t])?r:e,c=/(.*)?,([^,]+)$/,[,,d]=n.match(c);null==(l=i.setAttribute)||l.call(i,"_eid",n);const u=Object.keys(s).find((e=>{const[,n,i]=e.match(c);return n===t&&+i>=+d&&s[e]}));i._fragment&&(i=o(i)),u?a.insertBefore(i,null!=(h=s[u].startTag)?h:s[u]):a.append(i)}t.forEach((t=>{var e;null==(e=r[t.type])||e.call(r,t)})),Object.assign(s,i)}function G(t,e=document.body){let s=!1;const n={},i=new A,r=new F(e,(t=>{i.postMessage(f,t)}));function o(){i.destroy(),r.destroy(),e.replaceChildren()}return i.connect(t),i.register(d,(({body:t})=>{t[0].type===k&&(s=!0),s&&q(t,e,n,r)})),i.register(g,(()=>o)),o}function J(t,e){const{port1:s,port2:n}=new MessageChannel;return function(t){const e=new D;return t.channel=e,t.diff(),function(s){const n=e.connect(s);return e.register(c,(()=>t.callInital(n)),n),e.register(f,(({body:e})=>{e.cid=n,t.emit(e)}),n),e.register(g,(()=>e.disconnect(n))),n}}(t)(n),G(s,e)}},858:function(t,e,s){s.d(e,{Au:function(){return _},BX:function(){return F},HY:function(){return H},tZ:function(){return U}});var n=Object.defineProperty,i=(t,e,s)=>(((t,e,s)=>{e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s),r=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},o=(t,e,s)=>(r(t,e,"read from private field"),s?s.call(t):e.get(t)),l=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},h=(t,e,s,n)=>(r(t,e,"write to private field"),n?n.call(t,s):e.set(t,s),s),a=(t,e,s)=>(r(t,e,"access private method"),s);const c=1,d=2,u=5,p=7,f=1,v=2,g=3,y=4,m=5;var b,w,k,E;class P{constructor(){l(this,b),l(this,k),i(this,"target",new EventTarget),i(this,"pool",{}),i(this,"oncePool",{}),i(this,"listeners",[])}on(t,e){"function"==typeof e&&(this.pool[t]||(this.pool[t]=new Set)).add(e)}off(t,e){var s,n,i,r,o,l;void 0===e?null==(n=null==(s=this.pool[t])?void 0:s.clear)||n.call(s):(null==(r=null==(i=this.pool[t])?void 0:i.delete)||r.call(i,e),null==(l=null==(o=this.oncePool[t])?void 0:o.delete)||l.call(o,e))}once(t,e){"function"==typeof e&&(this.oncePool[t]||(this.oncePool[t]=new Set)).add(e)}dispatch(t,e=null){var s,n,i,r;const o=new CustomEvent(t,{detail:e,cancelable:!0,bubbles:!0}),l=self.onerror;let h;const c=new WeakMap,d=[];return self.onerror=(t,e,s,n,i)=>{d.push(i),c.set(h,i)},this.listeners=[...null!=(s=this.oncePool["*"])?s:[],...null!=(n=this.oncePool[t])?n:[],...null!=(i=this.pool["*"])?i:[],...null!=(r=this.pool[t])?r:[]].map((t=>e=>{h=t;const s=t(e);d.push(s),c.set(h,s)})),this.oncePool["*"]=new Set,this.oncePool[t]=new Set,a(this,b,w).call(this,t),this.target.dispatchEvent(o),o.result=t=>c.get(t),o.results=d,self.onerror=l,a(this,k,E).call(this,t),o}}b=new WeakSet,w=function(t){this.listeners.forEach((e=>{this.target.addEventListener(t,e)}))},k=new WeakSet,E=function(t){this.listeners.forEach((e=>{this.target.removeEventListener(t,e)})),this.listeners=[]};const $=new class{constructor(){i(this,"firstPaint",!0),i(this,"currentPhase",new Map),i(this,"nextPase",new Map),i(this,"timer"),i(this,"running",!1),i(this,"circleTimes",new WeakMap),i(this,"loop",(()=>{this.nextPase.size&&(this.currentPhase=this.nextPase,this.nextPase=new Map),this.running=!0;let t,e=[];if(this.currentPhase.forEach(((s,n)=>{var i,r,o;const l=null!=(i=this.circleTimes.get(n))?i:0;l>50&&(t=new Error(`<${null!=(r=n.tag.name)?r:n.tag} key=${null!=(o=n.key)?o:""}> 该组件循环更新多次!!!`)),this.circleTimes.set(n,l+1);const h=n.id.split(",").length;(e[h]||(e[h]=[])).push((()=>{this.currentPhase.delete(n),n.diff(this.currentPhase.get(n))}))})),e.forEach((t=>t.forEach((t=>t())))),e=[],t)throw t;if(this.nextPase.size)return this.firstPaint?this.loop():setTimeout(this.loop,0);this.firstPaint=!1,this.circleTimes=new WeakMap,this.running=!1,this.timer=null}))}add(t,e){this.running&&!this.currentPhase.has(t)?this.nextPase.set(t,this.nextPase.get(t)||e):this.currentPhase.set(t,this.currentPhase.get(t)||e),!this.timer&&(this.timer=Promise.resolve().then(this.loop))}delete(t){const e=new RegExp(`^${t.id}`);this.currentPhase.forEach(((t,s)=>{e.test(s.id)&&this.currentPhase.delete(s)})),this.nextPase.forEach(((t,s)=>{e.test(s.id)&&this.nextPase.delete(s)}))}};function M(t=[],e){const s=[],n=[];return e.forEach(((i,r)=>{const o=t.findIndex((t=>function(t,e){if(!C(t,e))return!1;const i={id:e.id,curNode:e,diffrent:!1};if(t.id!==e.id&&(n.push({from:e.index,to:t.index}),e._text&&(e.id=t.id),e.index=t.index),W(t.props,e.props)||(i.diffrent=!0,Object.keys({...e.props,...t.props}).forEach((s=>{e.props[s]=t.props[s]})),i.props=e.props),!W(t.eventHandlers,e.eventHandlers)){let s=!1;e.offBindEventHandlers(),Object.keys({...e.eventHandlers,...t.eventHandlers}).forEach((n=>{(!e.eventHandlers[n]||!t.eventHandlers[n])&&(s=!0),e.eventHandlers[n]=t.eventHandlers[n]})),i.diffrent=i.diffrent||s,i.eventHandlers=e.eventHandlers,e.bindEventHandlers()}return R(t.children,e.children)||(i.diffrent=!0,e.children.splice(0,e.children.length,...t.children)),s.push(i),!0}(i,t)));o>=0&&(t[o]=null,e[r]=null)})),{updateds:s,moves:n}}const x=Symbol("IS_RENDER");function _(t){return t[x]=!0,t}function H(t,e=[]){return e}class O{constructor(t){i(this,"parent"),i(this,"destroyed",!1),i(this,"$scope",new Set),i(this,"index",0),i(this,"hook",new P),i(this,"updateHandler"),i(this,"channel"),i(this,"patchs",[]),i(this,"tag",H),i(this,"key"),i(this,"children",[]),i(this,"props",{}),i(this,"eventHandlers",{}),i(this,"results",[]),i(this,"update",(t=>{$.add(this,t)})),i(this,"destroy",(()=>{$.delete(this),this.destroyed=!0,this.parent=null,this.$scope.clear(),this.channel=null,this.offBindEventHandlers(),this.results.forEach((t=>{var e;return null==(e=t.emit)?void 0:e.call(t,{type:"destroy"})}))})),i(this,"userHook",new Proxy({},{get:(t,e)=>{e=e.replace(/_capture$/,"");const s=t=>{this.emit({type:e,detail:t})},n=t=>this.hook.on(`${e}_capture`,t);return Object.assign(n,{once:t=>{this.hook.once(`${e}_capture`,t)},off:t=>{this.hook.off(`${e}_capture`,t)}}),Object.assign(s,{on:t=>{this.hook.on(e,t)},once:t=>{this.hook.once(e,t)},off:t=>{this.hook.off(e,t)},before:n}),s}})),i(this,"post",function(t){let e=null;return function(...s){return e||(e=Promise.resolve().then((()=>{t.apply(this,s),e=null}))),e}}((()=>{this.channel&&this.patchs.length&&this.channel.postMessage(d,this.patchs),this.patchs=[]}))),Object.assign(this,t),this.hook.on("update",this.update),this.hook.on("destroy",this.destroy),this.bindEventHandlers()}static filterProps(t){if(!t)return;const e=["boolean","string","number"];return Object.keys(t).reduce(((s,n)=>e.includes(typeof t[n])?{...s,[n]:t[n]}:s),{})}static filterEventHandlers(t){if(t)return[...new Set(Object.keys(t).map((t=>t.replace(/_capture$/,""))))]}static node2obj(t){return t=t instanceof O?{id:t.id,tag:"function"==typeof t.tag?t.tag.name:t.tag,props:this.filterProps(t.props),eventHandlers:this.filterEventHandlers(t.eventHandlers),_fragment:"function"==typeof t.tag}:{id:t.id,text:t.text,_text:!0}}get id(){var t,e;return`${null!=(e=null==(t=this.parent)?void 0:t.id)?e:""},${this.index}`}callInital(t){var e;if(!this.channel)return;const s=[],n=[this];for(;n.length;){const t=n.shift();n.push(...null!=(e=t.results)?e:[]),s.push(O.node2obj(t))}this.post().finally((()=>{this.channel.postMessage(d,[{id:this.id,type:m,payload:s}],t)}))}emit(t){var e,s;const n=!(null!=(e=t.detail)&&e._eid),i=new RegExp(`^${this.id}`).test(null==(s=t.detail)?void 0:s._eid);if(!n&&!i)return;const r=t.type.replace(/_capture$/,""),o=`${r}_capture`;return t.cancelBubble||(t=this.hook.dispatch(o,t.detail)),n||this.results.forEach((e=>{var s,n;t=null!=(n=null==(s=e.emit)?void 0:s.call(e,t))?n:t})),!(t=t.cancelBubble?t:this.hook.dispatch(r,t.detail)).defaultPrevented&&!["update","destroy"].includes(r)&&t.results.length&&(t.results.forEach((t=>{var e;null==(e=null==t?void 0:t.then)||e.call(t,(()=>{this.$scope.forEach((t=>{t.destroyed?this.$scope.delete(t):t.emit({type:"update"})}))}))})),this.$scope.forEach((t=>{t.destroyed?this.$scope.delete(t):t.emit({type:"update"})}))),t}setResults(t){this.results=T([t]).map(((t,e)=>{var s,n,i;if(t instanceof O){t.parent=this,t.index=e,t.$scope.add(this);const r=[...t.children];for(;r.length;){const t=r.pop();null!=(s=t.children)&&s.length&&r.push(...t.children),null==(i=null==(n=null==t?void 0:t.$scope)?void 0:n.add)||i.call(n,this)}}else t={id:`${this.id},${e}`,index:e,text:t+"",_text:!0};return t}))}callOut(t,e,s){const n=this.patchs[this.patchs.length-1];(null==n?void 0:n.id)===t&&n.type<g&&e===v?Object.assign(n.payload,s):this.patchs.push({id:t,type:e,payload:s}),this.post()}bindEventHandlers(){Object.keys(this.eventHandlers).forEach((t=>{this.hook.on(t,this.eventHandlers[t])}))}offBindEventHandlers(){Object.keys(this.eventHandlers).forEach((t=>{this.hook.off(t,this.eventHandlers[t])}))}diff(t){if(this.destroyed)return;const e=[...this.results];let s=this.children;if("function"==typeof this.tag&&(s=this.fetch()),this.results===s)return;this.setResults(s);const n=[...this.results],{updateds:i,moves:r}=M(e,n);i.forEach((e=>{var s,n;e.diffrent&&this.callOut(e.id,v,{props:O.filterProps(e.props),eventHandlers:O.filterEventHandlers(e.eventHandlers)}),this.results[e.curNode.index]=e.curNode,(e.diffrent||t)&&(null==(n=(s=e.curNode).emit)||n.call(s,{type:"update"}))})),e.forEach((t=>{var e;t&&(this.callOut(t.id,g),null==(e=t.emit)||e.call(t,{type:"destroy"}))})),r.forEach((({from:t,to:e})=>{this.callOut(`${this.id},${t}`,y,{id:`${this.id},${e}`})})),n.forEach((t=>{t&&(this.callOut(t.id,f,O.node2obj(t)),t instanceof O&&(t.channel=this.channel,t.emit({type:"update"})))}))}fetch(){var t,e;const s=null!=(t=this.updateHandler)?t:this.tag.bind(null,this.props,this.children,this.userHook);this.hook.once("__fetch__",s);let n=this.hook.dispatch("__fetch__").result(s);return n instanceof Error&&(n=null!=(e=this.results)?e:[]),"function"==typeof n&&n[x]&&(this.updateHandler=n,n=n()),n}}function j(t){return t.map((t=>"function"==typeof t&&t[x]?j([t()]):Array.isArray(t)?j(t):t instanceof O?new t.constructor({tag:t.tag,props:{...t.props},children:[...t.children],$scope:new Set(t.$scope.values()),key:t.key,eventHandlers:{...t.eventHandlers}}):t))}function T(t){return j(t).flat(1/0).filter((t=>!!t))}function W(t,e){if(t===e)return!0;if(typeof t!=typeof e||"object"!=typeof t||!t||!e)return!1;const s=Object.keys({...t,...e});for(let n=0;n<s.length;n++){const i=s[n];if(!W(t[i],e[i]))return!1}return!0}function C(t,e){return t===e||!(!t||!e)&&(t+""==e+""&&t.tag+""==e.tag+""&&t.key===e.key&&t.text===e.text)}function R(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;let s=t.length;for(;s--;){const n=t[s],i=e[s];if(!(C(n,i)&&W(n.props,i.props)&&W(n.eventHandlers,i.eventHandlers)&&R(n.children,i.children)))return!1}return!0}class S{constructor(t){i(this,"port"),this.port=t}static getInstance(t){if(this.map.has(t))return this.map.get(t);const e=new this(t);return this.map.set(t,e),e}}i(S,"map",new WeakMap);class N extends S{constructor(t){super(t),i(this,"lastTime",performance.now()),i(this,"count",0),this.postMessage({type:c})}get version(){return`${this.lastTime}-${this.count}`}postMessage(t){t.prev=this.version,t.current=this.updateVersion(),this.port.postMessage(t)}updateVersion(){const t=performance.now();return t!==this.lastTime?(this.lastTime=t,this.count=0):this.count++,this.version}}i(N,"map",new WeakMap);class B extends S{constructor(t){var e;super(t),i(this,"version",""),i(this,"buffer",{}),i(this,"hook",new P),i(this,"onMessage",(({data:t})=>{const{type:e,current:s,prev:n}=t;if(e===c){if(this.version)return;this.version=s,this.hook.dispatch(e)}else this.buffer[n]=t;this.readBuffer()})),t.addEventListener("message",this.onMessage),null==(e=t.start)||e.call(t)}readBuffer(){if(!this.version)return;const t=Object.keys(this.buffer).sort(((t,e)=>{const[s,n]=t.split("-"),[i,r]=e.split("-");return s-i||n-r})),[e,s]=this.version.split("-");for(;t.length;){const n=t.pop(),[i,r]=n.split("-");if(+i<+e||i===e&&+r<+s){Reflect.deleteProperty(this.buffer,n);continue}if(this.version!==n)return;const{type:o,current:l,...h}=this.buffer[n];this.version=l,Reflect.deleteProperty(this.buffer,n),this.hook.dispatch(o,h)}}register(t,e){t===c?this.version?this.hook.once(t,e):e():this.hook.on(t,e)}unregister(t,e){this.hook.off(t,e)}}var I,A,L;i(B,"map",new WeakMap);class D{constructor(){l(this,I,void 0),l(this,A,void 0),l(this,L,{}),i(this,"destroyed",!0)}connect(t){this.destroyed||this.destroy(),h(this,A,B.getInstance(t)),h(this,I,N.getInstance(t)),this.destroyed=!1}register(t,e){o(this,L)[t]=t=>e(null==t?void 0:t.detail),o(this,A).register(t,o(this,L)[t])}postMessage(t,e){const s=o(this,I).version;return o(this,I).postMessage({type:t,body:e}),s}destroy(){this.destroyed||(this.postMessage(p),Object.keys(o(this,L),(t=>{o(this,A).unregister(t,o(this,L)[t])})),h(this,L,{}),h(this,I,null),h(this,A,null))}}I=new WeakMap,A=new WeakMap,L=new WeakMap;class V extends O{constructor(){super(...arguments),i(this,"microChannel"),i(this,"lastPort"),i(this,"inited",!1),i(this,"patchHandler",(({body:t})=>{t[0].type===m&&(this.inited=!0),this.inited&&this.channel.postMessage(d,t.map((({id:t,type:e,payload:s})=>{const n={id:`${this.id}${t}`,type:e,payload:s};return e===m&&(n.payload=s.map((t=>({...t,id:`${this.id}${t.id}`})))),e===y&&(n.payload={...s,id:`${this.id}${s.id}`}),n})))}))}diff(){var t,e;this.lastPort!==this.props.port&&(this.lastPort=this.props.port,null==(e=null==(t=this.microChannel)?void 0:t.destroy)||e.call(t),this.inited=!1,this.microChannel=new D,this.microChannel.connect(this.props.port),this.microChannel.register(d,this.patchHandler),this.microChannel.register(p,(()=>this.destroy())))}emit(t){var e;const s=new RegExp(`^${this.id}`),n=s.test(null==(e=t.detail)?void 0:e._eid),i=t.type.replace(/_capture$/,"");return n&&this.microChannel.postMessage(u,{type:i,detail:{...t.detail,_eid:t.detail._eid.replace(s,"")}}),super.emit(t)}destroy(){var t,e;super.destroy(),null==(e=null==(t=this.microChannel)?void 0:t.destroy)||e.call(t),this.microChannel=null,this.lastPort=null}}function z(){}function F(t,e,s){if("function"!=typeof t&&"string"!=typeof t)throw new TypeError(`意外的tag类型<${t}>`);const n=t===z?V:O;let{children:i,eventHandlers:r,props:o}=function(t){const e={children:[],eventHandlers:{},props:{}};return Object.keys(t).forEach((s=>{"children"===s?e.children=t[s]:/^on-/.test(s)?e.eventHandlers[s.replace(/^on-/,"")]=t[s]:/^before-/.test(s)?e.eventHandlers[s.replace(/^before-/,"")+"_capture"]=t[s]:e.props[s]=t[s]})),e}(e);return i=T(i),new n({tag:t,props:o,children:i,eventHandlers:r,key:s})}function U(t,e,s){return e.children=[e.children],F(t,e,s)}}}]);